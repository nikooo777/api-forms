<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/css/bootstrap.css">
  </head>
  <body>
    <div class="container" style="max-width: 800px">
      <h1>Edit User</h1>

      <div id="alert" class="alert show" style="visibility: hidden;">
        <button type="button" class="close" onclick="$(this).closest('.alert').css('visibility', 'hidden')">
          <span aria-hidden="true">&times;</span>
        </button>
        <div class="alert-content"></div>
      </div>

      <form id="form">
        <div class="form-group mb-4">
          <label>Auth Token</label> <input class="form-control" type=text name="auth_token" />
        </div>

        <div class="form-group mb-4">
          <label>User's Email</label> <input class="form-control" type=text name="email" />
        </div>

        <div class="form-group mb-4">
          <label>Invites Remaining</label> <input class="form-control" type=text name="invites_remaining" />
        </div>

        <div class="form-group mb-4">
          <label>Identity Verified?</label>
          <div class="form-check">
            <label class="form-check-label"> <input class="form-check-input" type="radio" name="is_identity_verified" value="" checked>
              <em>leave as is</em> </label>
          </div>
          <div class="form-check">
            <label class="form-check-label"> <input class="form-check-input" type="radio" name="is_identity_verified" value="yes">
              Yes </label>
          </div>
          <div class="form-check">
            <label class="form-check-label"> <input class="form-check-input" type="radio" name="is_identity_verified" value="no">
              No </label>
          </div>
        </div>

        <div class="form-group mb-4">
          <label>Reward Approved?</label>
          <div class="form-check">
            <label class="form-check-label"> <input class="form-check-input" type="radio" name="is_reward_approved" value="" checked>
              <em>leave as is</em> </label>
          </div>
          <div class="form-check">
            <label class="form-check-label"> <input class="form-check-input" type="radio" name="is_reward_approved" value="auto">
              Let the code decide </label>
          </div>
          <div class="form-check">
            <label class="form-check-label"> <input class="form-check-input" type="radio" name="is_reward_approved" value="yes">
              Yes </label>
          </div>
          <div class="form-check">
            <label class="form-check-label"> <input class="form-check-input" type="radio" name="is_reward_approved" value="no">
              No </label>
          </div>
        </div>

        <button type="submit" class="btn btn-primary">Update</button>

      </form>
    </div>

    <!-- jQuery first, then Tether, then Bootstrap JS. -->
    <script src="/js/jquery-3.2.1.js"></script>
    <script src="/js/tether.min.js"></script>
    <script src="/js/bootstrap.js"></script>
    <script>
      $(document).ready(function () {
        var form = $("#form");
        var alert = $("#alert");
        var host;

        if (window.location.host.indexOf("localhost") === 0) {
          host = "http://localhost:8080";
          $('h1').after('<div class="alert alert-info">Sending requests to ' + host + '</div>');
        } else {
          host = "https://api.lbry.io";
        }

        form.find('input[name="auth_token"]').val(window.localStorage.getItem("auth_token"));

        form.on("submit", function (event) {
          event.preventDefault();

          alert.css("visibility", "hidden");
          form.find('button[type=submit]').text("Working...").addClass("disabled");

          const data = $.param($.map(form.serializeArray(), function(field, index) {
            // if field is empty and doesnt have data-submit-empty=1, skip it entirely.
            // for radios/checkboxes, any input having data-submit-empty=1 will cause the field to be included.
            return (field.value == "" && form.find("[name="+field.name+"]").filter(function(){return $(this).data('submit-empty')}).length == 0) ?
                   null :
                   field;
          }));

          window.localStorage.setItem("auth_token", form.find('[name="auth_token"]').val());

          $.ajax({
            url: host + '/user/edit',
            type: "POST",
            dataType: 'json',
            data: data,
            success: function (result) {
              alert.addClass('alert-success').removeClass("alert-danger").find('.alert-content').text(JSON.stringify(result.data, null, 2));
            },
            error: function (xhr, response, text) {
              alert.addClass('alert-danger').removeClass("alert-success").find('.alert-content').text(xhr.responseJSON.error);
            },
            complete: function() {
              alert.css("visibility", "visible")
              form.find('button[type=submit]').text("Update").removeClass("disabled");
            },
          })
        });
      });
    </script>
  </body>
</html>
